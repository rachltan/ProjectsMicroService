<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Projects</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: linear-gradient(135deg, #7A6FD6 0%, #4F56C0 100%);
    min-height: 100vh;
  }

  .page-wrap {
    max-width: 1100px;
    margin: 30px auto 40px auto;
    padding: 0 16px;
  }

  /* ===== TOP BAR (like hardware page) ===== */
  .top-bar {
    background: #ffffff;
    border-radius: 18px;
    padding: 16px 24px;
    box-shadow: 0 14px 40px rgba(0,0,0,0.18);
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
  }

  .top-bar-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .top-title {
    font-size: 22px;
    font-weight: 700;
    color: #333;
  }

  .top-sub {
    font-size: 13px;
    color: #666;
  }

  .top-bar-right {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 13px;
  }

  .top-bar-right span {
    color: #555;
  }

  .top-bar-right span strong {
    font-weight: 600;
  }

  .btn-chip {
    padding: 8px 14px;
    border-radius: 999px;
    font-size: 13px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .btn-dashboard {
    background: #4f9cff;
    color: #fff;
  }

  .btn-dashboard:hover {
    background: #356fd0;
  }

  .btn-logout {
    background: #e03b3b;
    color: #fff;
  }

  .btn-logout:hover {
    background: #b32626;
  }

  /* ===== MAIN CARD ===== */
  .container {
    background: #ffffff;
    padding: 28px 32px 32px;
    border-radius: 18px;
    box-shadow: 0 18px 50px rgba(0,0,0,0.22);
    width: 100%;
  }

  h1 {
    text-align:left;
    color:#333;
    margin-bottom:18px;
    font-size:24px;
  }

  .subtitle {
    font-size: 14px;
    color: #666;
    margin-bottom: 24px;
  }

  .layout-row {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
  }

  .panel {
    flex: 1;
    min-width: 260px;
  }

  .panel-inner {
    border-radius: 12px;
    border: 1px solid #ececec;
    padding: 18px 18px 20px;
    background: #fafbff;
  }

  .section-title {
    font-size:18px;
    font-weight:600;
    color:#333;
    margin-bottom:14px;
  }

  .form-group { margin-bottom:14px; }

  label {
    display:block;
    margin-bottom:6px;
    color:#555;
    font-weight:500;
    font-size:14px;
  }

  input, textarea {
    width:100%;
    padding:10px;
    border:2px solid #e0e0e0;
    border-radius:8px;
    font-size:15px;
    transition:border-color .3s;
    font-family:inherit;
  }

  input:focus, textarea:focus {
    outline:none;
    border-color:#667eea;
  }

  textarea {
    min-height:80px;
    resize:vertical;
  }

  button {
    width:100%;
    padding:12px;
    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    color:white;
    border:none;
    border-radius:8px;
    font-size:15px;
    font-weight:600;
    cursor:pointer;
    transition:transform .2s, box-shadow .2s;
    margin-top:4px;
  }

  button:hover {
    transform:translateY(-1px);
    box-shadow:0 8px 18px rgba(0,0,0,0.18);
  }

  button:active {
    transform:translateY(0);
    box-shadow:none;
  }

  .sub-button {
    margin-top:10px;
    background:linear-gradient(135deg,#4f9cff 0%,#325fb3 100%);
  }

  .message {
    padding:10px;
    border-radius:8px;
    margin-top:10px;
    text-align:left;
    display:none;
    font-size:13px;
  }

  .message.success {
    background:#d4edda;
    color:#155724;
    border:1px solid #c3e6cb;
  }

  .message.error {
    background:#f8d7da;
    color:#721c24;
    border:1px solid #f5c6cb;
  }

  .project-details {
    margin-top:10px;
    font-size:14px;
    color:#333;
  }

  .project-details p {
    margin:4px 0;
  }

  @media (max-width: 720px) {
    .top-bar {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }
    .top-bar-right {
      align-self: stretch;
      justify-content: space-between;
    }
  }
</style>
</head>
<body>
  <div class="page-wrap">
    <!-- HEADER BAR -->
    <div class="top-bar">
      <div class="top-bar-left">
        <span style="font-size:22px;">üß©</span>
        <div>
          <div class="top-title">Project Management</div>
          <div class="top-sub">Create and access projects tied to hardware resources.</div>
        </div>
      </div>
      <div class="top-bar-right">
        <span>Welcome, <strong>Guest</strong></span>
        <span>Project: <strong>None Selected</strong></span>
        <a href="/" class="btn-chip btn-dashboard">‚Üê Dashboard</a>
        <button type="button" class="btn-chip btn-logout">Logout</button>
      </div>
    </div>

    <!-- MAIN CARD -->
    <div class="container">
      <h1>Projects</h1>
      <p class="subtitle">
        Create a new project or quickly look up an existing one by Project ID, then view its
        associated hardware sets.
      </p>

      <!-- GLOBAL MESSAGE (for quick feedback) -->
      <div id="globalMessage" class="message"></div>

      <div class="layout-row">
        <!-- ===== CREATE NEW PROJECT ===== -->
        <div class="panel">
          <div class="panel-inner">
            <div class="section-title">Create New Project</div>

            <div class="form-group">
              <label for="newProjectId">Project ID</label>
              <input id="newProjectId" placeholder="e.g. P1001" />
            </div>

            <div class="form-group">
              <label for="newProjectName">Project Name</label>
              <input id="newProjectName" placeholder="My Cool Project" />
            </div>

            <div class="form-group">
              <label for="newProjectDesc">Description</label>
              <textarea id="newProjectDesc" placeholder="Short description"></textarea>
            </div>

            <button id="createBtn" type="button">Create Project</button>
            <div id="createMessage" class="message"></div>
          </div>
        </div>

        <!-- ===== ACCESS EXISTING PROJECT ===== -->
        <div class="panel">
          <div class="panel-inner">
            <div class="section-title">Access Existing Project</div>

            <div class="form-group">
              <label for="accessProjectId">Project ID</label>
              <input id="accessProjectId" placeholder="Enter existing Project ID" />
            </div>

            <button id="accessBtn" type="button">Access Project</button>
            <div id="accessMessage" class="message"></div>

            <div id="projectDetails" class="project-details" style="display:none;">
              <p><strong>Project Name:</strong> <span id="detailName"></span></p>
              <p><strong>Description:</strong> <span id="detailDesc"></span></p>
              <p><strong>Hardware Sets:</strong> <span id="detailHardwareSummary"></span></p>
              <p><strong>Checked Out:</strong> <span id="detailChecked"></span></p>

              <button id="hardwarePopupBtn" type="button" class="sub-button">
                Show Hardware Sets
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
  const globalMessage = document.getElementById('globalMessage');
  const createMessage = document.getElementById('createMessage');
  const accessMessage = document.getElementById('accessMessage');

  const createBtn = document.getElementById('createBtn');
  const accessBtn = document.getElementById('accessBtn');
  const hardwarePopupBtn = document.getElementById('hardwarePopupBtn');

  const projectDetailsDiv = document.getElementById('projectDetails');
  const detailName = document.getElementById('detailName');
  const detailDesc = document.getElementById('detailDesc');
  const detailHardwareSummary = document.getElementById('detailHardwareSummary');
  const detailChecked = document.getElementById('detailChecked');

  let currentHardwareSets = [];

  function showMessage(el, text, type) {
    el.textContent = text;
    el.className = 'message ' + type;
    el.style.display = 'block';
  }
  function hideMessage(el) {
    el.style.display = 'none';
  }

  // ===== CREATE PROJECT =====
  createBtn.addEventListener('click', async () => {
    hideMessage(createMessage);
    hideMessage(globalMessage);

    const project_id = document.getElementById('newProjectId').value.trim();
    const project_name = document.getElementById('newProjectName').value.trim();
    const project_desc = document.getElementById('newProjectDesc').value.trim();

    if (!project_id || !project_name) {
      showMessage(createMessage, 'Project ID and Project Name are required.', 'error');
      return;
    }

    const payload = { project_id, project_name, project_desc };

    try {
      const resp = await fetch('/projects', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await resp.json();

      if (!resp.ok || !data.success) {
        showMessage(createMessage, data.message || 'Failed to create project.', 'error');
        return;
      }

      showMessage(createMessage, 'Project created successfully.', 'success');

    } catch (err) {
      console.error(err);
      showMessage(createMessage, 'Error calling /projects (create).', 'error');
    }
  });

  // ===== ACCESS PROJECT =====
  accessBtn.addEventListener('click', async () => {
    hideMessage(accessMessage);
    hideMessage(globalMessage);
    projectDetailsDiv.style.display = 'none';
    currentHardwareSets = [];

    const project_id = document.getElementById('accessProjectId').value.trim();
    if (!project_id) {
      showMessage(accessMessage, 'Please enter a Project ID.', 'error');
      return;
    }

    try {
      const resp = await fetch(`/projects/${encodeURIComponent(project_id)}`);
      const data = await resp.json();

      if (!resp.ok || !data.success) {
        showMessage(accessMessage, data.message || 'Project not found.', 'error');
        return;
      }

      const p = data.project || {};

      detailName.textContent = p.project_name || '';
      detailDesc.textContent = p.project_desc || '';

      currentHardwareSets = Array.isArray(p.hardware_set_id)
        ? p.hardware_set_id
        : (p.hardware_set_id ? [String(p.hardware_set_id)] : []);

      if (currentHardwareSets.length === 0) {
        detailHardwareSummary.textContent = 'No hardware sets available';
      } else {
        detailHardwareSummary.textContent = currentHardwareSets.join(', ');
      }

      const checked = typeof p.num_of_hardware_sets === 'number'
        ? p.num_of_hardware_sets
        : parseInt(p.num_of_hardware_sets || '0', 10) || 0;
      detailChecked.textContent = checked;

      projectDetailsDiv.style.display = 'block';

    } catch (err) {
      console.error(err);
      showMessage(accessMessage, 'Error calling /projects (get).', 'error');
    }
  });

  // ===== HARDWARE POPUP =====
  hardwarePopupBtn.addEventListener('click', () => {
    if (!currentHardwareSets || currentHardwareSets.length === 0) {
      alert('No hardware sets associated with this project.');
    } else {
      alert('Hardware sets for this project:\n\n' + currentHardwareSets.join(', '));
    }
  });
</script>
</body>
</html>
