<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Projects</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body {
    font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    background: linear-gradient(135deg,#7A6FD6 0%,#4F56C0 100%);
    min-height:100vh; display:flex; align-items:flex-start; justify-content:center;
    padding:40px;
  }
  .container{
    background:white; padding:36px; border-radius:16px;
    box-shadow:0 20px 60px rgba(0,0,0,0.25);
    width:100%; max-width:960px;
  }
  h1{color:#333; font-size:26px; margin-bottom:24px}
  .grid{display:grid; grid-template-columns:1fr 1fr; gap:24px}
  .card{border:1px solid #eef; border-radius:14px; padding:18px}
  .section-title{font-size:18px; font-weight:700; color:#333; margin-bottom:12px}
  .form-group{margin-bottom:14px}
  label{display:block; margin-bottom:6px; color:#555; font-weight:600; font-size:14px}
  input, textarea, select{
    width:100%; padding:10px; border:2px solid #e0e0e0; border-radius:10px;
    font-size:15px; transition:border-color .2s;
  }
  input:focus, textarea:focus, select:focus{outline:none; border-color:#667eea}
  textarea{min-height:72px; resize:vertical}
  .row{display:flex; gap:12px}
  .row > *{flex:1}

  button{
    padding:12px 14px; width:100%;
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:white; border:none; border-radius:10px; font-weight:700; cursor:pointer;
    transition:transform .15s;
  }
  button:hover{transform:translateY(-2px)}
  .btn-secondary{background:linear-gradient(135deg,#4f9cff,#325fb3)}
  .btn-ghost{
    background:white; color:#4f5bd5; border:2px solid #cfd6ff;
  }

  .message{margin-top:10px; padding:10px; border-radius:10px; font-size:14px; display:none}
  .message.success{background:#d4edda; color:#155724; border:1px solid #c3e6cb}
  .message.error{background:#f8d7da; color:#721c24; border:1px solid #f5c6cb}

  .details{margin-top:10px; font-size:14px; color:#333}
  .details p{margin:6px 0}
</style>
</head>
<body>
  <div class="container">
    <h1>Projects</h1>

    <div class="grid">
      <!-- CREATE -->
      <div class="card">
        <div class="section-title">Create New Project</div>
        <div class="form-group">
          <label for="newProjectId">Project ID</label>
          <input id="newProjectId" placeholder="e.g. P1001" />
        </div>

        <div class="form-group">
          <label for="newProjectName">Project Name</label>
          <input id="newProjectName" placeholder="My Cool Project" />
        </div>

        <div class="row">
          <div class="form-group">
            <label for="newState">Target State (optional)</label>
            <select id="newState">
              <option value="">All States</option>
              <option value="AL">AL</option><option value="AK">AK</option><option value="AZ">AZ</option>
              <option value="AR">AR</option><option value="CA">CA</option><option value="CO">CO</option>
              <option value="CT">CT</option><option value="DE">DE</option><option value="FL">FL</option>
              <option value="GA">GA</option><option value="HI">HI</option><option value="ID">ID</option>
              <option value="IL">IL</option><option value="IN">IN</option><option value="IA">IA</option>
              <option value="KS">KS</option><option value="KY">KY</option><option value="LA">LA</option>
              <option value="ME">ME</option><option value="MD">MD</option><option value="MA">MA</option>
              <option value="MI">MI</option><option value="MN">MN</option><option value="MS">MS</option>
              <option value="MO">MO</option><option value="MT">MT</option><option value="NE">NE</option>
              <option value="NV">NV</option><option value="NH">NH</option><option value="NJ">NJ</option>
              <option value="NM">NM</option><option value="NY">NY</option><option value="NC">NC</option>
              <option value="ND">ND</option><option value="OH">OH</option><option value="OK">OK</option>
              <option value="OR">OR</option><option value="PA">PA</option><option value="RI">RI</option>
              <option value="SC">SC</option><option value="SD">SD</option><option value="TN">TN</option>
              <option value="TX">TX</option><option value="UT">UT</option><option value="VT">VT</option>
              <option value="VA">VA</option><option value="WA">WA</option><option value="WV">WV</option>
              <option value="WI">WI</option><option value="WY">WY</option>
            </select>
          </div>
          <div class="form-group">
            <label for="newCategory">Target Category (optional)</label>
            <input id="newCategory" placeholder="e.g., Grocery, Insurance" />
          </div>
        </div>

        <div class="form-group">
          <label for="newProjectDesc">Description</label>
          <textarea id="newProjectDesc" placeholder="Short description (goals, timing, etc.)"></textarea>
        </div>

        <button id="createBtn" type="button">Create Project</button>
        <div id="createMsg" class="message"></div>
      </div>

      <!-- ACCESS -->
      <div class="card">
        <div class="section-title">Access Existing Project</div>
        <div class="form-group">
          <label for="accessProjectId">Project ID</label>
          <input id="accessProjectId" placeholder="Enter existing Project ID" />
        </div>

        <div class="row">
          <button id="accessBtn" type="button" class="btn-secondary">Access Project</button>
          <button id="openTopBrandsBtn" type="button" class="btn-ghost">Open Top Brands</button>
        </div>

        <div id="accessMsg" class="message"></div>

        <div id="details" class="details" style="display:none;">
          <p><strong>Name:</strong> <span id="dName"></span></p>
          <p><strong>Description:</strong> <span id="dDesc"></span></p>
          <p><strong>State:</strong> <span id="dState"></span></p>
          <p><strong>Category:</strong> <span id="dCategory"></span></p>
          <p><strong>Hardware Sets:</strong> <span id="dHw"></span></p>
          <p><strong>Checked Out:</strong> <span id="dChecked"></span></p>
        </div>
      </div>
    </div>
  </div>

<script>
  const createBtn = document.getElementById('createBtn');
  const accessBtn = document.getElementById('accessBtn');
  const openTopBrandsBtn = document.getElementById('openTopBrandsBtn');
  const createMsg = document.getElementById('createMsg');
  const accessMsg = document.getElementById('accessMsg');
  const details = document.getElementById('details');

  let lastLoadedProject = null;

  function show(el, text, type){ el.textContent = text; el.className = 'message ' + type; el.style.display='block'; }
  function hide(el){ el.style.display='none'; }

  // CREATE
  createBtn.addEventListener('click', async ()=> {
    hide(createMsg);
    const payload = {
      project_id:   document.getElementById('newProjectId').value.trim(),
      project_name: document.getElementById('newProjectName').value.trim(),
      project_desc: document.getElementById('newProjectDesc').value.trim(),
      state:        document.getElementById('newState').value,
      category:     document.getElementById('newCategory').value.trim()
    };
    if(!payload.project_id || !payload.project_name){
      show(createMsg, 'Project ID and Project Name are required.', 'error');
      return;
    }
    try{
      const r = await fetch('/projects', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const data = await r.json();
      if(!r.ok || !data.success) return show(createMsg, data.message || 'Failed to create project.', 'error');
      show(createMsg, 'Project created.', 'success');
    }catch(e){
      show(createMsg, 'Error calling /projects.', 'error');
    }
  });

  // ACCESS
  accessBtn.addEventListener('click', async ()=> {
    hide(accessMsg); details.style.display='none';
    lastLoadedProject = null;

    const pid = document.getElementById('accessProjectId').value.trim();
    if(!pid) return show(accessMsg, 'Enter a Project ID.', 'error');

    try{
      const r = await fetch(`/projects/${encodeURIComponent(pid)}`);
      const data = await r.json();
      if(!r.ok || !data.success) return show(accessMsg, data.message || 'Project not found.', 'error');

      const p = data.project || {};
      lastLoadedProject = p;

      document.getElementById('dName').textContent = p.project_name || '';
      document.getElementById('dDesc').textContent = p.project_desc || '';
      document.getElementById('dState').textContent = p.state || '';
      document.getElementById('dCategory').textContent = p.category || '';

      const hw = Array.isArray(p.hardware_set_id) ? p.hardware_set_id : (p.hardware_set_id ? [String(p.hardware_set_id)] : []);
      document.getElementById('dHw').textContent = hw.length ? hw.join(', ') : 'None';

      const checked = typeof p.num_of_hardware_sets === 'number' ? p.num_of_hardware_sets : parseInt(p.num_of_hardware_sets || '0',10) || 0;
      document.getElementById('dChecked').textContent = checked;

      details.style.display='block';
    }catch(e){
      show(accessMsg, 'Error calling /projects (get).', 'error');
    }
  });

  // OPEN TOP BRANDS (prefill filters via query params)
  openTopBrandsBtn.addEventListener('click', ()=>{
    const pid = document.getElementById('accessProjectId').value.trim();
    const st = lastLoadedProject?.state || '';
    const cat = lastLoadedProject?.category || '';
    const q = new URLSearchParams();
    if(st)  q.set('state', st);
    if(cat) q.set('category', cat);
    const url = '/top10companies' + (q.toString() ? `?${q.toString()}` : '');
    window.location.href = url;
  });
</script>
</body>
</html>
