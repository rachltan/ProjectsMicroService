<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Projects Dashboard</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 24px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 24px;
    }
    h2 {
      font-size: 22px;
      margin-bottom: 12px;
    }
    .panel {
      border: 1px solid #ddd;
      padding: 16px 18px 20px;
      margin-bottom: 24px;
    }
    .form-row {
      margin-bottom: 10px;
    }
    input, textarea {
      width: 260px;
      padding: 6px 8px;
      font-size: 14px;
      border: 1px solid #aaa;
      border-radius: 2px;
      box-sizing: border-box;
    }
    textarea {
      height: 60px;
      resize: vertical;
    }
    button {
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 2px;
      border: 1px solid #444;
      background: #f8f8f8;
      cursor: pointer;
    }
    button:hover {
      background: #eaeaea;
    }
    .message {
      margin-top: 8px;
      font-size: 14px;
    }
    .message.error {
      color: #b3261e;
    }
    .message.success {
      color: #1b5e20;
    }
    .project-details {
      margin-top: 14px;
      font-size: 15px;
    }
    .project-details p {
      margin: 4px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Projects</h1>

    <!-- ============= CREATE NEW PROJECT ============= -->
    <div class="panel">
      <h2>Create New Project</h2>

      <div class="form-row">
        <input id="newProjectId" placeholder="Project ID">
      </div>
      <div class="form-row">
        <input id="newProjectName" placeholder="Project Name">
      </div>
      <div class="form-row">
        <textarea id="newProjectDesc" placeholder="Description"></textarea>
      </div>
      <div class="form-row">
        <input id="newMembers" placeholder="Members (comma separated)">
      </div>
      <div class="form-row">
        <input id="newHardwareIds" placeholder="Hardware Set IDs (comma separated)">
      </div>
      <div class="form-row">
        <input id="newNumHardware" placeholder="# Hardware Sets Checked Out" type="number" min="0">
      </div>

      <button id="createBtn">Create</button>

      <div id="createMessage" class="message"></div>
    </div>

    <!-- ============= EXISTING PROJECT ============= -->
    <div class="panel">
      <h2>Existing Project</h2>

      <div class="form-row">
        <input id="existingProjectId" placeholder="Project ID">
      </div>

      <button id="accessBtn">Access Project</button>

      <div id="accessMessage" class="message"></div>

      <div id="projectDetails" class="project-details" style="display:none;">
        <p><strong>Project Name:</strong> <span id="detailName"></span></p>
        <p><strong>Description:</strong> <span id="detailDesc"></span></p>
        <p><strong>Hardware Sets:</strong> <span id="detailHardware"></span></p>
        <p><strong>Checked Out:</strong> <span id="detailChecked"></span></p>
      </div>
    </div>
  </div>

  <script>
    const createBtn = document.getElementById('createBtn');
    const accessBtn = document.getElementById('accessBtn');

    const createMessage = document.getElementById('createMessage');
    const accessMessage = document.getElementById('accessMessage');

    const detailBox = document.getElementById('projectDetails');
    const detailName = document.getElementById('detailName');
    const detailDesc = document.getElementById('detailDesc');
    const detailHardware = document.getElementById('detailHardware');
    const detailChecked = document.getElementById('detailChecked');

    function setMessage(el, text, isError = false) {
      el.textContent = text;
      el.className = 'message ' + (isError ? 'error' : 'success');
    }

    // -------- Create New Project --------
    createBtn.addEventListener('click', async () => {
      createMessage.textContent = '';

      const project_id = document.getElementById('newProjectId').value.trim();
      const project_name = document.getElementById('newProjectName').value.trim();
      const project_desc = document.getElementById('newProjectDesc').value.trim();
      const members_raw = document.getElementById('newMembers').value.trim();
      const hardware_raw = document.getElementById('newHardwareIds').value.trim();
      const num_raw = document.getElementById('newNumHardware').value.trim();

      if (!project_id || !project_name) {
        setMessage(createMessage, 'Project ID and Project Name are required.', true);
        return;
      }

      const payload = {
        project_id,
        project_name,
        project_desc,
        members_list: members_raw,          // backend will split commas
        hardware_set_id: hardware_raw,      // backend will split commas
        num_of_hardware_sets: num_raw || 0
      };

      try {
        const resp = await fetch('/projects', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await resp.json();

        if (!resp.ok || !data.success) {
          setMessage(createMessage, data.message || 'Failed to create project.', true);
          return;
        }

        setMessage(createMessage, 'Project created successfully.');

        // Optional: clear fields
        // document.getElementById('newProjectId').value = '';
        // document.getElementById('newProjectName').value = '';
        // document.getElementById('newProjectDesc').value = '';
        // document.getElementById('newMembers').value = '';
        // document.getElementById('newHardwareIds').value = '';
        // document.getElementById('newNumHardware').value = '';

      } catch (err) {
        console.error(err);
        setMessage(createMessage, 'Error calling /projects (create).', true);
      }
    });

    // -------- Access Existing Project --------
    accessBtn.addEventListener('click', async () => {
      accessMessage.textContent = '';
      detailBox.style.display = 'none';

      const project_id = document.getElementById('existingProjectId').value.trim();
      if (!project_id) {
        setMessage(accessMessage, 'Please enter a Project ID.', true);
        return;
      }

      try {
        const resp = await fetch(`/projects/${encodeURIComponent(project_id)}`);
        const data = await resp.json();

        if (!resp.ok || !data.success) {
          setMessage(accessMessage, data.message || 'Project not found.', true);
          return;
        }

        const p = data.project || {};

        detailName.textContent = p.project_name || '';
        detailDesc.textContent = p.project_desc || '';

        const hwList = Array.isArray(p.hardware_set_id) ? p.hardware_set_id : [];
        detailHardware.textContent =
          hwList.length ? hwList.join(', ') : 'No hardware sets available';

        const checked = typeof p.num_of_hardware_sets === 'number'
          ? p.num_of_hardware_sets
          : parseInt(p.num_of_hardware_sets || '0', 10) || 0;
        detailChecked.textContent = checked;

        detailBox.style.display = 'block';
        accessMessage.textContent = '';

      } catch (err) {
        console.error(err);
        setMessage(accessMessage, 'Error calling /projects (get).', true);
      }
    });
  </script>
</body>
</html>
